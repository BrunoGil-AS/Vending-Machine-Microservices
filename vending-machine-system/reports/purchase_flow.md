# issue in purchase flow

**Description:**

when performing the suite test for [`customer_flow_test.py`](../tests/integration/customer_flow_test.py). The payment and transactions works, they start the transaction, complete the payment, but the transaction service does not update the transaction status to COMPLETED after receiving the payment event. This probably because the dispensing service is not marking as dispensed the items, so the transaction service does not proceed to complete the transaction. So refund process stars instead.

## Just After finishing the test, but before stuck items

**logs from transaction service:**

```bash
2025-10-17 14:05:41 [http-nio-8083-exec-6] INFO  c.v.t.config.SecurityConfig - Request received from: 192.168.100.53
2025-10-17 14:05:41 [http-nio-8083-exec-6] INFO  c.v.t.config.SecurityConfig - Request made to: /api/transaction/purchase
2025-10-17 14:05:41 [http-nio-8083-exec-6] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: purchase, CorrelationId: 86626973-a6fd-40d4-b76b-ebc62b2bbe19, Args: 1
2025-10-17 14:05:41 [http-nio-8083-exec-6] INFO  c.v.t.transaction.TransactionService - Starting anonymous purchase transaction for 1 items
2025-10-17 14:05:41 [http-nio-8083-exec-6] INFO  c.v.t.transaction.TransactionService - Inventory check result: true
2025-10-17 14:05:41 [http-nio-8083-exec-6] INFO  c.v.t.transaction.TransactionService - Payment processing result: true (status: SUCCESS)
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.t.kafka.TransactionEventConsumer - Received payment event: ab9673c5-473e-4622-8e60-a74a5d6ff04d for transaction 1
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] ERROR c.v.t.kafka.TransactionEventConsumer - Transaction 1 not found for payment event ab9673c5-473e-4622-8e60-a74a5d6ff04d
2025-10-17 14:05:41 [http-nio-8083-exec-6] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-start-1-1760731541557 for transaction 1
2025-10-17 14:05:41 [http-nio-8083-exec-6] INFO  c.v.t.transaction.TransactionService - Purchase transaction initiated: 1
2025-10-17 14:05:41 [http-nio-8083-exec-6] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: purchase, CorrelationId: 86626973-a6fd-40d4-b76b-ebc62b2bbe19, Duration: 519ms
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.t.kafka.TransactionEventConsumer - Received payment event: 6ed8a070-f1cd-4008-bb0c-d577835302ab for transaction 2
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] ERROR c.v.t.kafka.TransactionEventConsumer - Transaction 2 not found for payment event 6ed8a070-f1cd-4008-bb0c-d577835302ab
2025-10-17 14:05:42 [scheduling-1] DEBUG c.v.t.t.TransactionTimeoutService - Checking for stuck transactions...
2025-10-17 14:05:44 [http-nio-8083-exec-3] INFO  c.v.t.config.SecurityConfig - Request received from: 192.168.100.53
2025-10-17 14:05:44 [http-nio-8083-exec-3] INFO  c.v.t.config.SecurityConfig - Request made to: /api/transaction/purchase
2025-10-17 14:05:44 [http-nio-8083-exec-3] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: purchase, CorrelationId: 8873404b-5da1-409c-b977-d2d5bb8296fe, Args: 1
2025-10-17 14:05:44 [http-nio-8083-exec-3] INFO  c.v.t.transaction.TransactionService - Starting anonymous purchase transaction for 1 items
2025-10-17 14:05:44 [http-nio-8083-exec-3] INFO  c.v.t.transaction.TransactionService - Inventory check result: true
2025-10-17 14:05:44 [http-nio-8083-exec-3] INFO  c.v.t.transaction.TransactionService - Payment processing result: true (status: SUCCESS)
2025-10-17 14:05:44 [http-nio-8083-exec-3] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-start-2-1760731544847 for transaction 2
2025-10-17 14:05:44 [http-nio-8083-exec-3] INFO  c.v.t.transaction.TransactionService - Purchase transaction initiated: 2
2025-10-17 14:05:44 [http-nio-8083-exec-3] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: purchase, CorrelationId: 8873404b-5da1-409c-b977-d2d5bb8296fe, Duration: 77ms
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.t.kafka.TransactionEventConsumer - Received payment event: 3430037e-11fb-438e-8a95-f42cc907f8dc for transaction 3
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] ERROR c.v.t.kafka.TransactionEventConsumer - Transaction 3 not found for payment event 3430037e-11fb-438e-8a95-f42cc907f8dc
2025-10-17 14:05:47 [http-nio-8083-exec-7] INFO  c.v.t.config.SecurityConfig - Request received from: 192.168.100.53
2025-10-17 14:05:47 [http-nio-8083-exec-7] INFO  c.v.t.config.SecurityConfig - Request made to: /api/transaction/purchase
2025-10-17 14:05:47 [http-nio-8083-exec-7] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: purchase, CorrelationId: 5e4ea945-13a7-4c19-85d3-6991cc50c1a2, Args: 1
2025-10-17 14:05:47 [http-nio-8083-exec-7] INFO  c.v.t.transaction.TransactionService - Starting anonymous purchase transaction for 1 items
2025-10-17 14:05:47 [http-nio-8083-exec-7] INFO  c.v.t.transaction.TransactionService - Inventory check result: true
2025-10-17 14:05:47 [http-nio-8083-exec-7] INFO  c.v.t.transaction.TransactionService - Payment processing result: true (status: SUCCESS)
2025-10-17 14:05:47 [http-nio-8083-exec-7] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-start-3-1760731547970 for transaction 3
2025-10-17 14:05:47 [http-nio-8083-exec-7] INFO  c.v.t.transaction.TransactionService - Purchase transaction initiated: 3
2025-10-17 14:05:47 [http-nio-8083-exec-7] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: purchase, CorrelationId: 5e4ea945-13a7-4c19-85d3-6991cc50c1a2, Duration: 68ms
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.t.kafka.TransactionEventConsumer - Received payment event: 878ec1ba-81e8-4873-aa5e-15972f4d541b for transaction 4
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] ERROR c.v.t.kafka.TransactionEventConsumer - Transaction 4 not found for payment event 878ec1ba-81e8-4873-aa5e-15972f4d541b
2025-10-17 14:05:51 [http-nio-8083-exec-2] INFO  c.v.t.config.SecurityConfig - Request received from: 192.168.100.53
2025-10-17 14:05:51 [http-nio-8083-exec-2] INFO  c.v.t.config.SecurityConfig - Request made to: /api/transaction/purchase
2025-10-17 14:05:51 [http-nio-8083-exec-2] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: purchase, CorrelationId: 81db1e11-ee1a-4c09-836d-f9b7b7086cf8, Args: 1
2025-10-17 14:05:51 [http-nio-8083-exec-2] INFO  c.v.t.transaction.TransactionService - Starting anonymous purchase transaction for 2 items
2025-10-17 14:05:51 [http-nio-8083-exec-2] INFO  c.v.t.transaction.TransactionService - Inventory check result: true
2025-10-17 14:05:51 [http-nio-8083-exec-2] INFO  c.v.t.transaction.TransactionService - Payment processing result: true (status: SUCCESS)
2025-10-17 14:05:51 [http-nio-8083-exec-2] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-start-4-1760731551123 for transaction 4
2025-10-17 14:05:51 [http-nio-8083-exec-2] INFO  c.v.t.transaction.TransactionService - Purchase transaction initiated: 4
2025-10-17 14:05:51 [http-nio-8083-exec-2] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: purchase, CorrelationId: 81db1e11-ee1a-4c09-836d-f9b7b7086cf8, Duration: 87ms
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.t.kafka.TransactionEventConsumer - Received payment event: efc959a1-3f11-4f27-b00d-5dc5ce60c987 for transaction 5
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] ERROR c.v.t.kafka.TransactionEventConsumer - Transaction 5 not found for payment event efc959a1-3f11-4f27-b00d-5dc5ce60c987
2025-10-17 14:05:54 [http-nio-8083-exec-10] INFO  c.v.t.config.SecurityConfig - Request received from: 192.168.100.53
2025-10-17 14:05:54 [http-nio-8083-exec-10] INFO  c.v.t.config.SecurityConfig - Request made to: /api/transaction/purchase
2025-10-17 14:05:54 [http-nio-8083-exec-10] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: purchase, CorrelationId: 88c5c7c9-a8ce-444f-a9c4-0e6dd3b0886b, Args: 1
2025-10-17 14:05:54 [http-nio-8083-exec-10] INFO  c.v.t.transaction.TransactionService - Starting anonymous purchase transaction for 3 items
2025-10-17 14:05:54 [http-nio-8083-exec-10] INFO  c.v.t.transaction.TransactionService - Inventory check result: true
2025-10-17 14:05:54 [http-nio-8083-exec-10] INFO  c.v.t.transaction.TransactionService - Payment processing result: true (status: SUCCESS)
2025-10-17 14:05:54 [http-nio-8083-exec-10] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-start-5-1760731554310 for transaction 5
2025-10-17 14:05:54 [http-nio-8083-exec-10] INFO  c.v.t.transaction.TransactionService - Purchase transaction initiated: 5
2025-10-17 14:05:54 [http-nio-8083-exec-10] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: purchase, CorrelationId: 88c5c7c9-a8ce-444f-a9c4-0e6dd3b0886b, Duration: 107ms
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.t.kafka.TransactionEventConsumer - Received payment event: a44f737d-2da8-49de-bbb7-6d840ad08f2f for transaction 6
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] ERROR c.v.t.kafka.TransactionEventConsumer - Transaction 6 not found for payment event a44f737d-2da8-49de-bbb7-6d840ad08f2f
2025-10-17 14:05:57 [http-nio-8083-exec-4] INFO  c.v.t.config.SecurityConfig - Request received from: 192.168.100.53
2025-10-17 14:05:57 [http-nio-8083-exec-4] INFO  c.v.t.config.SecurityConfig - Request made to: /api/transaction/purchase
2025-10-17 14:05:57 [http-nio-8083-exec-4] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: purchase, CorrelationId: 5095cff6-edf2-44fe-b5d9-b0c776dc6621, Args: 1
2025-10-17 14:05:57 [http-nio-8083-exec-4] INFO  c.v.t.transaction.TransactionService - Starting anonymous purchase transaction for 2 items
2025-10-17 14:05:57 [http-nio-8083-exec-4] INFO  c.v.t.transaction.TransactionService - Inventory check result: true
2025-10-17 14:05:57 [http-nio-8083-exec-4] INFO  c.v.t.transaction.TransactionService - Payment processing result: true (status: SUCCESS)
2025-10-17 14:05:57 [http-nio-8083-exec-4] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-start-6-1760731557456 for transaction 6
2025-10-17 14:05:57 [http-nio-8083-exec-4] INFO  c.v.t.transaction.TransactionService - Purchase transaction initiated: 6
2025-10-17 14:05:57 [http-nio-8083-exec-4] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: purchase, CorrelationId: 5095cff6-edf2-44fe-b5d9-b0c776dc6621, Duration: 86ms
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.t.kafka.TransactionEventConsumer - Received payment event: d956f0e5-c64e-413d-928c-008c2995f746 for transaction 7
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] ERROR c.v.t.kafka.TransactionEventConsumer - Transaction 7 not found for payment event d956f0e5-c64e-413d-928c-008c2995f746
```

---

**logs from payment service:**

```bash
2025-10-17 14:05:41 [http-nio-8082-exec-2] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:05:41 [http-nio-8082-exec-2] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/process
2025-10-17 14:05:41 [http-nio-8082-exec-2] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: fbd41275-8d88-4050-861f-43d189f4c037
2025-10-17 14:05:41 [http-nio-8082-exec-2] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 0 with amount 1.0 and method CASH
2025-10-17 14:05:41 [http-nio-8082-exec-2] INFO  c.v.payment.payment.PaymentService - Payment successful for transaction 0
2025-10-17 14:05:41 [http-nio-8082-exec-2] INFO  c.v.payment.payment.PaymentService - Published payment event: PaymentEvent(eventId=ab9673c5-473e-4622-8e60-a74a5d6ff04d, transactionId=1, amount=1.0, method=CASH, status=SUCCESS, timestamp=1760731541336)
2025-10-17 14:05:41 [http-nio-8082-exec-2] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: fbd41275-8d88-4050-861f-43d189f4c037
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-start-1-1760731541557 for transaction 1 with status STARTED
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 1 with amount 1.0 and method CREDIT_CARD
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Payment successful for transaction 1
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Published payment event: PaymentEvent(eventId=6ed8a070-f1cd-4008-bb0c-d577835302ab, transactionId=2, amount=1.0, method=CREDIT_CARD, status=SUCCESS, timestamp=1760731541706)
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Payment processing initiated for transaction 1
2025-10-17 14:05:44 [http-nio-8082-exec-4] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:05:44 [http-nio-8082-exec-4] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/process
2025-10-17 14:05:44 [http-nio-8082-exec-4] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: 209d3a63-01fd-4563-8b15-4e18eed7eb6c
2025-10-17 14:05:44 [http-nio-8082-exec-4] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 0 with amount 2.0 and method CREDIT_CARD
2025-10-17 14:05:44 [http-nio-8082-exec-4] WARN  c.v.payment.payment.PaymentService - Payment already exists for transaction 0
2025-10-17 14:05:44 [http-nio-8082-exec-4] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: 209d3a63-01fd-4563-8b15-4e18eed7eb6c
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-start-2-1760731544847 for transaction 2 with status STARTED
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 2 with amount 2.0 and method CREDIT_CARD
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Payment successful for transaction 2
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Published payment event: PaymentEvent(eventId=3430037e-11fb-438e-8a95-f42cc907f8dc, transactionId=3, amount=2.0, method=CREDIT_CARD, status=SUCCESS, timestamp=1760731544866)
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Payment processing initiated for transaction 2
2025-10-17 14:05:47 [http-nio-8082-exec-5] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:05:47 [http-nio-8082-exec-5] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/process
2025-10-17 14:05:47 [http-nio-8082-exec-5] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: 32c0e13f-ebef-443e-ae7c-94290ba3b5b2
2025-10-17 14:05:47 [http-nio-8082-exec-5] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 0 with amount 1.0 and method DEBIT_CARD
2025-10-17 14:05:47 [http-nio-8082-exec-5] WARN  c.v.payment.payment.PaymentService - Payment already exists for transaction 0
2025-10-17 14:05:47 [http-nio-8082-exec-5] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: 32c0e13f-ebef-443e-ae7c-94290ba3b5b2
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-start-3-1760731547970 for transaction 3 with status STARTED
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 3 with amount 1.0 and method CREDIT_CARD
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Payment successful for transaction 3
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Published payment event: PaymentEvent(eventId=878ec1ba-81e8-4873-aa5e-15972f4d541b, transactionId=4, amount=1.0, method=CREDIT_CARD, status=SUCCESS, timestamp=1760731547985)
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Payment processing initiated for transaction 3
2025-10-17 14:05:51 [http-nio-8082-exec-6] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:05:51 [http-nio-8082-exec-6] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/process
2025-10-17 14:05:51 [http-nio-8082-exec-6] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: 299accc1-36b7-419d-8391-0a151b7d32fe
2025-10-17 14:05:51 [http-nio-8082-exec-6] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 0 with amount 5.0 and method CASH
2025-10-17 14:05:51 [http-nio-8082-exec-6] WARN  c.v.payment.payment.PaymentService - Payment already exists for transaction 0
2025-10-17 14:05:51 [http-nio-8082-exec-6] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: 299accc1-36b7-419d-8391-0a151b7d32fe
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-start-4-1760731551123 for transaction 4 with status STARTED
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 4 with amount 5.0 and method CREDIT_CARD
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Payment successful for transaction 4
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Published payment event: PaymentEvent(eventId=efc959a1-3f11-4f27-b00d-5dc5ce60c987, transactionId=5, amount=5.0, method=CREDIT_CARD, status=SUCCESS, timestamp=1760731551137)
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Payment processing initiated for transaction 4
2025-10-17 14:05:54 [http-nio-8082-exec-7] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:05:54 [http-nio-8082-exec-7] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/process
2025-10-17 14:05:54 [http-nio-8082-exec-7] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: a4f55e7b-19aa-44c4-a90b-7e07e4c56384
2025-10-17 14:05:54 [http-nio-8082-exec-7] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 0 with amount 5.5 and method CREDIT_CARD
2025-10-17 14:05:54 [http-nio-8082-exec-7] WARN  c.v.payment.payment.PaymentService - Payment already exists for transaction 0
2025-10-17 14:05:54 [http-nio-8082-exec-7] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: a4f55e7b-19aa-44c4-a90b-7e07e4c56384
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-start-5-1760731554310 for transaction 5 with status STARTED
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 5 with amount 5.5 and method CREDIT_CARD
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Payment successful for transaction 5
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Published payment event: PaymentEvent(eventId=a44f737d-2da8-49de-bbb7-6d840ad08f2f, transactionId=6, amount=5.5, method=CREDIT_CARD, status=SUCCESS, timestamp=1760731554323)
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Payment processing initiated for transaction 5
2025-10-17 14:05:57 [http-nio-8082-exec-8] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:05:57 [http-nio-8082-exec-8] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/process
2025-10-17 14:05:57 [http-nio-8082-exec-8] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: 649627b1-18f9-4c92-835b-8da8a38b5200
2025-10-17 14:05:57 [http-nio-8082-exec-8] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 0 with amount 7.0 and method DEBIT_CARD
2025-10-17 14:05:57 [http-nio-8082-exec-8] WARN  c.v.payment.payment.PaymentService - Payment already exists for transaction 0
2025-10-17 14:05:57 [http-nio-8082-exec-8] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: 649627b1-18f9-4c92-835b-8da8a38b5200
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-start-6-1760731557456 for transaction 6 with status STARTED
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation started - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Processing payment for transaction: 6 with amount 7.0 and method CREDIT_CARD
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Payment successful for transaction 6
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.payment.payment.PaymentService - Published payment event: PaymentEvent(eventId=d956f0e5-c64e-413d-928c-008c2995f746, transactionId=7, amount=7.0, method=CREDIT_CARD, status=SUCCESS, timestamp=1760731557471)
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.m.PaymentLoggingAspect - Payment operation completed - Method: processPaymentForTransaction, CorrelationId: f7058825-1a73-41dc-b8dd-8713a0df3c4a
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Payment processing initiated for transaction 6
```

---

**logs from notification service:**

```bash
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-1-1760731541557 for transaction 1 with status STARTED
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-2-1760731544847 for transaction 2 with status STARTED
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-3-1760731547970 for transaction 3 with status STARTED
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-4-1760731551123 for transaction 4 with status STARTED
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-5-1760731554310 for transaction 5 with status STARTED
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-6-1760731557456 for transaction 6 with status STARTED
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
```

---

**logs from notification service:**

```bash
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received payment event: ab9673c5-473e-4622-8e60-a74a5d6ff04d with status SUCCESS
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation started - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.n.NotificationService - Created notification: PAYMENT_SUCCESS - Payment successful for transaction 1. Amount: $1.00, Method: CASH
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation completed - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received transaction event: txn-start-1-1760731541557 with status STARTED
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] DEBUG c.v.n.kafka.EventConsumers - Ignoring transaction event with status: STARTED
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received payment event: 6ed8a070-f1cd-4008-bb0c-d577835302ab with status SUCCESS
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation started - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.n.NotificationService - Created notification: PAYMENT_SUCCESS - Payment successful for transaction 2. Amount: $1.00, Method: CREDIT_CARD
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation completed - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received transaction event: txn-start-2-1760731544847 with status STARTED
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] DEBUG c.v.n.kafka.EventConsumers - Ignoring transaction event with status: STARTED
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received payment event: 3430037e-11fb-438e-8a95-f42cc907f8dc with status SUCCESS
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation started - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.n.NotificationService - Created notification: PAYMENT_SUCCESS - Payment successful for transaction 3. Amount: $2.00, Method: CREDIT_CARD
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation completed - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received transaction event: txn-start-3-1760731547970 with status STARTED
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] DEBUG c.v.n.kafka.EventConsumers - Ignoring transaction event with status: STARTED
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received payment event: 878ec1ba-81e8-4873-aa5e-15972f4d541b with status SUCCESS
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation started - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02

2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.n.NotificationService - Created notification: PAYMENT_SUCCESS - Payment successful for transaction 4. Amount: $1.00, Method: CREDIT_CARD
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation completed - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received transaction event: txn-start-4-1760731551123 with status STARTED
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] DEBUG c.v.n.kafka.EventConsumers - Ignoring transaction event with status: STARTED
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received payment event: efc959a1-3f11-4f27-b00d-5dc5ce60c987 with status SUCCESS
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation started - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.n.NotificationService - Created notification: PAYMENT_SUCCESS - Payment successful for transaction 5. Amount: $5.00, Method: CREDIT_CARD
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation completed - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received transaction event: txn-start-5-1760731554310 with status STARTED
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] DEBUG c.v.n.kafka.EventConsumers - Ignoring transaction event with status: STARTED
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received payment event: a44f737d-2da8-49de-bbb7-6d840ad08f2f with status SUCCESS
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation started - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.n.NotificationService - Created notification: PAYMENT_SUCCESS - Payment successful for transaction 6. Amount: $5.50, Method: CREDIT_CARD
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation completed - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received transaction event: txn-start-6-1760731557456 with status STARTED
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#2-0-C-1] DEBUG c.v.n.kafka.EventConsumers - Ignoring transaction event with status: STARTED
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.kafka.EventConsumers - Received payment event: d956f0e5-c64e-413d-928c-008c2995f746 with status SUCCESS
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation started - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.n.NotificationService - Created notification: PAYMENT_SUCCESS - Payment successful for transaction 7. Amount: $7.00, Method: CREDIT_CARD
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#3-0-C-1] INFO  c.v.n.m.NotificationLoggingAspect - Notification operation completed - Method: createNotification, CorrelationId: 2d137aeb-5f90-4ccd-8d90-25debcd92c02
2025-10-17 14:06:37 [AsyncResolver-bootstrap-executor-%d] INFO  c.n.d.s.r.aws.ConfigClusterResolver - Resolving eureka endpoints via configuration
```

---

**notes from below logs:**
the below logs were captured when tests were finally run to simulate purchase flow.

## after the services detected stucked items:

**logs from transaction service:**

```bash
2025-10-17 14:10:42 [scheduling-1] DEBUG c.v.t.t.TransactionTimeoutService - Checking for stuck transactions...
2025-10-17 14:10:42 [scheduling-1] WARN  c.v.t.t.TransactionTimeoutService - Found stuck transaction 1 in status PROCESSING created at 2025-10-17T14:05:41.476659
2025-10-17 14:10:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Args: 2
2025-10-17 14:10:42 [scheduling-1] INFO  c.v.t.transaction.TransactionService - Starting compensation for transaction 1: Transaction timeout - stuck in PROCESSING state
2025-10-17 14:10:42 [scheduling-1] ERROR c.v.t.transaction.TransactionService - Failed to process refund
org.springframework.web.client.HttpClientErrorException$NotFound: 404  on POST request for "http://localhost:8082/api/payment/refund": "{"timestamp":"2025-10-17T20:10:42.853+00:00","status":404,"error":"Not Found","trace":"org.springframework.web.servlet.resource.NoResourceFoundException: No static resource api/payment/refund.\r\n\tat org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)\r\n\tat org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)\r\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)\r\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)\r\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:490)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:351)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:83)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:129)\r\n\tat org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:334)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:225)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:110)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)\r\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)\r\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)\r\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)\r\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)\r\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\r\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)\r\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)\r\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)\r\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)\r\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1776)\r\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:975)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:493)\r\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)\r\n\tat java.base/java.lang.Thread.run(Thread.java:842)\r\n","message":"No static resource api/payment/refund.","path":"/api/payment/refund"}"
        at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:112)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:186)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147)
        at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953)
        at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902)
        at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801)
        at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:712)
        at com.vendingmachine.transaction.transaction.TransactionService.refundPayment(TransactionService.java:280)
        at com.vendingmachine.transaction.transaction.TransactionService.compensateTransaction(TransactionService.java:240)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
        at com.vendingmachine.transaction.monitoring.TransactionLoggingAspect.logTransactionOperations(TransactionLoggingAspect.java:42)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:649)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:631)
        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionService$$SpringCGLIB$$0.compensateTransaction(<generated>)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService.checkForStuckTransactions(TransactionTimeoutService.java:39)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService$$SpringCGLIB$$0.checkForStuckTransactions(<generated>)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
        at io.micrometer.observation.Observation.observe(Observation.java:498)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
        at org.springframework.scheduling.config.Task$OutcomeTrackingRunnable.run(Task.java:85)
        at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
        at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)
        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:842)
2025-10-17 14:10:42 [scheduling-1] WARN  c.v.t.transaction.TransactionService - Failed to refund payment for transaction 1, marking as FAILED
2025-10-17 14:10:42 [scheduling-1] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-comp-1-1760731842876 for transaction 1
2025-10-17 14:10:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Duration: 47ms
2025-10-17 14:10:42 [scheduling-1] INFO  c.v.t.t.TransactionTimeoutService - Processed 1 stuck transactions
2025-10-17 14:11:41 [AsyncResolver-bootstrap-executor-%d] INFO  c.n.d.s.r.aws.ConfigClusterResolver - Resolving eureka endpoints via configuration
2025-10-17 14:11:42 [scheduling-1] DEBUG c.v.t.t.TransactionTimeoutService - Checking for stuck transactions...
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.t.TransactionTimeoutService - Found stuck transaction 2 in status PROCESSING created at 2025-10-17T14:05:44.842574
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Args: 2
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.transaction.TransactionService - Starting compensation for transaction 2: Transaction timeout - stuck in PROCESSING state
2025-10-17 14:11:42 [scheduling-1] ERROR c.v.t.transaction.TransactionService - Failed to process refund
org.springframework.web.client.HttpClientErrorException$NotFound: 404  on POST request for "http://localhost:8082/api/payment/refund": "{"timestamp":"2025-10-17T20:11:42.856+00:00","status":404,"error":"Not Found","trace":"org.springframework.web.servlet.resource.NoResourceFoundException: No static resource api/payment/refund.\r\n\tat org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)\r\n\tat org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)\r\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)\r\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)\r\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:490)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:351)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:83)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:129)\r\n\tat org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:334)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:225)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:110)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)\r\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)\r\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)\r\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)\r\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)\r\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\r\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)\r\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)\r\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)\r\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)\r\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1776)\r\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:975)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:493)\r\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)\r\n\tat java.base/java.lang.Thread.run(Thread.java:842)\r\n","message":"No static resource api/payment/refund.","path":"/api/payment/refund"}"
        at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:112)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:186)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147)
        at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953)
        at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902)
        at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801)
        at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:712)
        at com.vendingmachine.transaction.transaction.TransactionService.refundPayment(TransactionService.java:280)
        at com.vendingmachine.transaction.transaction.TransactionService.compensateTransaction(TransactionService.java:240)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
        at com.vendingmachine.transaction.monitoring.TransactionLoggingAspect.logTransactionOperations(TransactionLoggingAspect.java:42)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:649)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:631)
        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionService$$SpringCGLIB$$0.compensateTransaction(<generated>)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService.checkForStuckTransactions(TransactionTimeoutService.java:39)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService$$SpringCGLIB$$0.checkForStuckTransactions(<generated>)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
        at io.micrometer.observation.Observation.observe(Observation.java:498)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
        at org.springframework.scheduling.config.Task$OutcomeTrackingRunnable.run(Task.java:85)
        at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
        at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)
        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:842)
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.transaction.TransactionService - Failed to refund payment for transaction 2, marking as FAILED
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-comp-2-1760731902866 for transaction 2
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Duration: 28ms
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.t.TransactionTimeoutService - Found stuck transaction 3 in status PROCESSING created at 2025-10-17T14:05:47.966786
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Args: 2
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.transaction.TransactionService - Starting compensation for transaction 3: Transaction timeout - stuck in PROCESSING state
2025-10-17 14:11:42 [scheduling-1] ERROR c.v.t.transaction.TransactionService - Failed to process refund
org.springframework.web.client.HttpClientErrorException$NotFound: 404  on POST request for "http://localhost:8082/api/payment/refund": "{"timestamp":"2025-10-17T20:11:42.886+00:00","status":404,"error":"Not Found","trace":"org.springframework.web.servlet.resource.NoResourceFoundException: No static resource api/payment/refund.\r\n\tat org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)\r\n\tat org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)\r\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)\r\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)\r\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:490)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:351)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:83)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:129)\r\n\tat org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:334)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:225)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:110)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)\r\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)\r\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)\r\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)\r\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)\r\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\r\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)\r\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)\r\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)\r\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)\r\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1776)\r\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:975)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:493)\r\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)\r\n\tat java.base/java.lang.Thread.run(Thread.java:842)\r\n","message":"No static resource api/payment/refund.","path":"/api/payment/refund"}"
        at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:112)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:186)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147)
        at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953)
        at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902)
        at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801)
        at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:712)
        at com.vendingmachine.transaction.transaction.TransactionService.refundPayment(TransactionService.java:280)
        at com.vendingmachine.transaction.transaction.TransactionService.compensateTransaction(TransactionService.java:240)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
        at com.vendingmachine.transaction.monitoring.TransactionLoggingAspect.logTransactionOperations(TransactionLoggingAspect.java:42)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:649)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:631)
        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionService$$SpringCGLIB$$0.compensateTransaction(<generated>)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService.checkForStuckTransactions(TransactionTimeoutService.java:39)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService$$SpringCGLIB$$0.checkForStuckTransactions(<generated>)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
        at io.micrometer.observation.Observation.observe(Observation.java:498)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
        at org.springframework.scheduling.config.Task$OutcomeTrackingRunnable.run(Task.java:85)
        at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
        at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)
        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:842)
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.transaction.TransactionService - Failed to refund payment for transaction 3, marking as FAILED
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-comp-3-1760731902896 for transaction 3
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Duration: 30ms
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.t.TransactionTimeoutService - Found stuck transaction 4 in status PROCESSING created at 2025-10-17T14:05:51.117789
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Args: 2
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.transaction.TransactionService - Starting compensation for transaction 4: Transaction timeout - stuck in PROCESSING state
2025-10-17 14:11:42 [scheduling-1] ERROR c.v.t.transaction.TransactionService - Failed to process refund
org.springframework.web.client.HttpClientErrorException$NotFound: 404  on POST request for "http://localhost:8082/api/payment/refund": "{"timestamp":"2025-10-17T20:11:42.916+00:00","status":404,"error":"Not Found","trace":"org.springframework.web.servlet.resource.NoResourceFoundException: No static resource api/payment/refund.\r\n\tat org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)\r\n\tat org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)\r\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)\r\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)\r\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:490)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:351)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:83)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:129)\r\n\tat org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:334)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:225)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:110)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)\r\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)\r\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)\r\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)\r\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)\r\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\r\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)\r\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)\r\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)\r\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)\r\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1776)\r\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:975)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:493)\r\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)\r\n\tat java.base/java.lang.Thread.run(Thread.java:842)\r\n","message":"No static resource api/payment/refund.","path":"/api/payment/refund"}"
        at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:112)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:186)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147)
        at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953)
        at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902)
        at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801)
        at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:712)
        at com.vendingmachine.transaction.transaction.TransactionService.refundPayment(TransactionService.java:280)
        at com.vendingmachine.transaction.transaction.TransactionService.compensateTransaction(TransactionService.java:240)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
        at com.vendingmachine.transaction.monitoring.TransactionLoggingAspect.logTransactionOperations(TransactionLoggingAspect.java:42)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:649)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:631)
        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionService$$SpringCGLIB$$0.compensateTransaction(<generated>)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService.checkForStuckTransactions(TransactionTimeoutService.java:39)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService$$SpringCGLIB$$0.checkForStuckTransactions(<generated>)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
        at io.micrometer.observation.Observation.observe(Observation.java:498)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
        at org.springframework.scheduling.config.Task$OutcomeTrackingRunnable.run(Task.java:85)
        at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
        at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)
        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:842)
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.transaction.TransactionService - Failed to refund payment for transaction 4, marking as FAILED
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-comp-4-1760731902925 for transaction 4
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Duration: 27ms
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.t.TransactionTimeoutService - Found stuck transaction 5 in status PROCESSING created at 2025-10-17T14:05:54.305666
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Args: 2
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.transaction.TransactionService - Starting compensation for transaction 5: Transaction timeout - stuck in PROCESSING state
2025-10-17 14:11:42 [scheduling-1] ERROR c.v.t.transaction.TransactionService - Failed to process refund
org.springframework.web.client.HttpClientErrorException$NotFound: 404  on POST request for "http://localhost:8082/api/payment/refund": "{"timestamp":"2025-10-17T20:11:42.946+00:00","status":404,"error":"Not Found","trace":"org.springframework.web.servlet.resource.NoResourceFoundException: No static resource api/payment/refund.\r\n\tat org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)\r\n\tat org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)\r\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)\r\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)\r\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:490)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:351)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:83)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:129)\r\n\tat org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:334)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:225)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:110)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)\r\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)\r\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)\r\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)\r\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)\r\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\r\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)\r\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)\r\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)\r\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)\r\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1776)\r\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:975)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:493)\r\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)\r\n\tat java.base/java.lang.Thread.run(Thread.java:842)\r\n","message":"No static resource api/payment/refund.","path":"/api/payment/refund"}"
        at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:112)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:186)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147)
        at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953)
        at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902)
        at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801)
        at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:712)
        at com.vendingmachine.transaction.transaction.TransactionService.refundPayment(TransactionService.java:280)
        at com.vendingmachine.transaction.transaction.TransactionService.compensateTransaction(TransactionService.java:240)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
        at com.vendingmachine.transaction.monitoring.TransactionLoggingAspect.logTransactionOperations(TransactionLoggingAspect.java:42)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:649)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:631)
        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionService$$SpringCGLIB$$0.compensateTransaction(<generated>)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService.checkForStuckTransactions(TransactionTimeoutService.java:39)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService$$SpringCGLIB$$0.checkForStuckTransactions(<generated>)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
        at io.micrometer.observation.Observation.observe(Observation.java:498)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
        at org.springframework.scheduling.config.Task$OutcomeTrackingRunnable.run(Task.java:85)
        at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
        at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)
        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:842)
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.transaction.TransactionService - Failed to refund payment for transaction 5, marking as FAILED
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-comp-5-1760731902956 for transaction 5
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Duration: 31ms
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.t.TransactionTimeoutService - Found stuck transaction 6 in status PROCESSING created at 2025-10-17T14:05:57.451142
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation started - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Args: 2
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.transaction.TransactionService - Starting compensation for transaction 6: Transaction timeout - stuck in PROCESSING state
2025-10-17 14:11:42 [scheduling-1] ERROR c.v.t.transaction.TransactionService - Failed to process refund
org.springframework.web.client.HttpClientErrorException$NotFound: 404  on POST request for "http://localhost:8082/api/payment/refund": "{"timestamp":"2025-10-17T20:11:42.976+00:00","status":404,"error":"Not Found","trace":"org.springframework.web.servlet.resource.NoResourceFoundException: No static resource api/payment/refund.\r\n\tat org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)\r\n\tat org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)\r\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)\r\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)\r\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)\r\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)\r\n\tat jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)\r\n\tat org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:490)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:351)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:83)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:129)\r\n\tat org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)\r\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)\r\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)\r\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)\r\n\tat org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)\r\n\tat org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:228)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:241)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:334)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:225)\r\n\tat org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:138)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)\r\n\tat org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)\r\n\tat org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)\r\n\tat org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)\r\n\tat org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)\r\n\tat org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:110)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\r\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)\r\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)\r\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)\r\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)\r\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)\r\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116)\r\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)\r\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\r\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)\r\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398)\r\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)\r\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903)\r\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1776)\r\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:975)\r\n\tat org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:493)\r\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)\r\n\tat java.base/java.lang.Thread.run(Thread.java:842)\r\n","message":"No static resource api/payment/refund.","path":"/api/payment/refund"}"
        at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:112)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:186)
        at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:147)
        at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:953)
        at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:902)
        at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:801)
        at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:712)
        at com.vendingmachine.transaction.transaction.TransactionService.refundPayment(TransactionService.java:280)
        at com.vendingmachine.transaction.transaction.TransactionService.compensateTransaction(TransactionService.java:240)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
        at com.vendingmachine.transaction.monitoring.TransactionLoggingAspect.logTransactionOperations(TransactionLoggingAspect.java:42)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:649)
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:631)
        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionService$$SpringCGLIB$$0.compensateTransaction(<generated>)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService.checkForStuckTransactions(TransactionTimeoutService.java:39)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:360)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380)
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728)
        at com.vendingmachine.transaction.transaction.TransactionTimeoutService$$SpringCGLIB$$0.checkForStuckTransactions(<generated>)
        at jdk.internal.reflect.GeneratedMethodAccessor67.invoke(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
        at io.micrometer.observation.Observation.observe(Observation.java:498)
        at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
        at org.springframework.scheduling.config.Task$OutcomeTrackingRunnable.run(Task.java:85)
        at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)
        at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)
        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
        at java.base/java.lang.Thread.run(Thread.java:842)
2025-10-17 14:11:42 [scheduling-1] WARN  c.v.t.transaction.TransactionService - Failed to refund payment for transaction 6, marking as FAILED
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.kafka.KafkaEventService - Published transaction event: txn-comp-6-1760731902983 for transaction 6
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.m.TransactionLoggingAspect - Transaction operation completed - Method: compensateTransaction, CorrelationId: 1a7e91a1-9ab3-4e83-aec8-b2dfe465e7ca, Duration: 27ms
2025-10-17 14:11:42 [scheduling-1] INFO  c.v.t.t.TransactionTimeoutService - Processed 5 stuck transactions
2025-10-17 14:12:42 [scheduling-1] DEBUG c.v.t.t.TransactionTimeoutService - Checking for stuck transactions...
```

**logs dispensing service:**

```bash
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-1-1760731541557 for transaction 1 with status STARTED
2025-10-17 14:05:41 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-2-1760731544847 for transaction 2 with status STARTED
2025-10-17 14:05:44 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-3-1760731547970 for transaction 3 with status STARTED
2025-10-17 14:05:47 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-4-1760731551123 for transaction 4 with status STARTED
2025-10-17 14:05:51 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-5-1760731554310 for transaction 5 with status STARTED
2025-10-17 14:05:54 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-start-6-1760731557456 for transaction 6 with status STARTED
2025-10-17 14:05:57 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: STARTED
2025-10-17 14:06:43 [AsyncResolver-bootstrap-executor-%d] INFO  c.n.d.s.r.aws.ConfigClusterResolver - Resolving eureka endpoints via configuration
2025-10-17 14:10:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-comp-1-1760731842876 for transaction 1 with status COMPENSATED
2025-10-17 14:10:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-comp-2-1760731902866 for transaction 2 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-comp-3-1760731902896 for transaction 3 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-comp-4-1760731902925 for transaction 4 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-comp-5-1760731902956 for transaction 5 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.d.kafka.TransactionEventConsumer - Received transaction event: txn-comp-6-1760731902983 for transaction 6 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.d.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
```

**payment service logs:**

```bash
2025-10-17 14:10:42 [http-nio-8082-exec-10] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:10:42 [http-nio-8082-exec-10] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/refund
2025-10-17 14:10:42 [http-nio-8082-exec-10] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:10:42 [http-nio-8082-exec-10] INFO  c.v.payment.config.SecurityConfig - Request made to: /error
2025-10-17 14:10:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-comp-1-1760731842876 for transaction 1 with status COMPENSATED
2025-10-17 14:10:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.p.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:40 [AsyncResolver-bootstrap-executor-%d] INFO  c.n.d.s.r.aws.ConfigClusterResolver - Resolving eureka endpoints via configuration
2025-10-17 14:11:42 [http-nio-8082-exec-1] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-1] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/refund
2025-10-17 14:11:42 [http-nio-8082-exec-1] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-1] INFO  c.v.payment.config.SecurityConfig - Request made to: /error
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-comp-2-1760731902866 for transaction 2 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.p.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:42 [http-nio-8082-exec-3] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-3] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/refund
2025-10-17 14:11:42 [http-nio-8082-exec-3] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-3] INFO  c.v.payment.config.SecurityConfig - Request made to: /error
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-comp-3-1760731902896 for transaction 3 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.p.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:42 [http-nio-8082-exec-2] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-2] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/refund
2025-10-17 14:11:42 [http-nio-8082-exec-2] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-2] INFO  c.v.payment.config.SecurityConfig - Request made to: /error
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-comp-4-1760731902925 for transaction 4 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.p.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:42 [http-nio-8082-exec-4] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-4] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/refund
2025-10-17 14:11:42 [http-nio-8082-exec-4] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-4] INFO  c.v.payment.config.SecurityConfig - Request made to: /error
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-comp-5-1760731902956 for transaction 5 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.p.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
2025-10-17 14:11:42 [http-nio-8082-exec-5] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-5] INFO  c.v.payment.config.SecurityConfig - Request made to: /api/payment/refund
2025-10-17 14:11:42 [http-nio-8082-exec-5] INFO  c.v.payment.config.SecurityConfig - Request received from: 127.0.0.1
2025-10-17 14:11:42 [http-nio-8082-exec-5] INFO  c.v.payment.config.SecurityConfig - Request made to: /error
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] INFO  c.v.p.kafka.TransactionEventConsumer - Received transaction event: txn-comp-6-1760731902983 for transaction 6 with status COMPENSATED
2025-10-17 14:11:42 [org.springframework.kafka.KafkaListenerEndpointContainer#0-0-C-1] DEBUG c.v.p.kafka.TransactionEventConsumer - Ignoring transaction event with status: COMPENSATED
```
